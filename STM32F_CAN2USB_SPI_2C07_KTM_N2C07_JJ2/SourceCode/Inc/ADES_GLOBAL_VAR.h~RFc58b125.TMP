
#ifndef __ADES_GLOBAL_VAR_H_
#define __ADES_GLOBAL_VAR_H_

#include "stm32f4xx_hal_adc.h" 
#include "stm32f4xx_hal_tim.h" 

#include "main.h"
#include "ADES_CFG.h"

// SYSTEM
extern uint32_t g_ulSysTick1MS;
extern uint32_t g_ulSysTick1MSFlag;
extern uint32_t g_ulSysTick1Sec;
extern uint16_t g_ausSysTickTaskRing[TICK_TASK_QUEUE_QUANTITY];
extern uint8_t  g_ucSysRingPtr;
extern uint8_t  g_ucSysRingTaskPtr;
extern uint8_t  g_ucSysTime[6];
extern uint8_t  g_ucSysMode; // For FSP500, 1:fsp550-70mua 0:fsp450-60mua
extern double   g_dSysWatt;

// Root
extern uint8_t  g_ucRootFlag;
extern uint8_t  g_ucRootFSP400ChargeManual;
extern uint8_t  g_ucRootFSP400FanManual;

// RESET
extern uint8_t g_ucResetFlag;

// LED
extern uint8_t  g_ucLedSysStatus;
extern uint8_t  g_ucLedFlashCount;
extern uint8_t  g_ucLedIdle;

// SYSTEM FLAG
extern uint32_t g_ulSysTickTaskFlag; 

// POWER & BATTERY
extern uint8_t   g_PowerOCP1;
extern uint8_t   g_PowerOCP2;
extern uint8_t   g_PowerOCP3;
extern uint8_t   g_PowerOVP1;
extern uint8_t   g_PowerOVP2;
extern uint8_t   g_PowerOVP3;
extern uint8_t   g_PowerUVP1;
extern uint8_t   g_PowerUVP2;
extern uint8_t   g_PowerOTP;
extern uint8_t   g_ucPwStateMachine;
extern uint8_t   g_ucAcFailFlag;           // charge flag 0 for charge process
extern uint8_t   g_ucBatteryType;
extern uint8_t   g_ucBatteryChargeMode;
extern uint8_t   g_ucBatteryChargeCC2CV; // 0:CC, 1:CV
extern uint8_t   g_ucBatteryChargeState; // 0:No Charge, 1:Normal Charge, 2: Fast Charge
extern uint8_t   g_ucBatteryChargeCount;
extern uint32_t  g_ulBatteryTime;
extern uint8_t   g_ucBatteryPercentage;
extern uint8_t   g_ucBatteryLowState; // 1:Low, >2:Critical low
extern uint32_t  g_ulBatteryChargeCurrentLimit;

extern uint8_t   g_ucBatteryLowCurrentTimer;
extern uint8_t   g_ucBatteryChargeStartLiPo; 
extern uint8_t   g_ucBatteryDischargeOcpFlag;
extern uint8_t   g_ucBatteryInsertEstimateTime;

//ROCK Info HT66 Battery_Full and if busy
extern uint16_t   g_ucBatteryFullFlag;
extern uint8_t    g_ucBatteryFullRechargeFlagCount;
extern uint8_t    g_ucBatteryRechargeFlag;

extern uint32_t  g_ulBatteryChargeTime; 
extern uint32_t  g_ulBatteryChargerDelay; 
extern uint32_t  g_ulBatteryStopChargerTimer;
extern uint32_t  g_ulBatteryStopChargerErrCount; 
extern uint8_t   g_ucBatteryChargerState; 


extern uint8_t   g_ucBatterySystemOnCharge;

extern uint8_t   g_ucBatteryCheckFlag;
extern uint8_t   g_ucBatteryHaltChargeFlag;

extern uint8_t   g_ucVoltageMode;
extern uint32_t  g_ulAdc0AlarmLimit;
extern uint32_t  g_ulAdc1AlarmLimit;
extern uint32_t  g_ulAdc2AlarmLimit;
extern uint32_t  g_ulAdc2AlarmLimit1Pack;
extern uint32_t  g_ulAdc2AlarmLimit2Pack;
extern uint32_t  g_ulAdc3AlarmLimit;
extern uint32_t  g_ulAdc4AlarmLimit;
extern uint32_t  g_ulAdc5AlarmLimit;
extern uint32_t  g_ulAdc6AlarmLimitH;
extern uint32_t  g_ulAdc6AlarmLimitL;
extern uint32_t  g_ulAdc8AlarmLimitH;
extern uint32_t  g_ulAdc8AlarmLimitL;

// CHECK BATTERY DISCHARGE FUNCTION
extern uint8_t   g_ChkBatDischargeFun;
extern uint8_t   g_ChkBatDischargeFunCount;

// BQ20Z45 ACTION
extern uint8_t   g_ucBqStateMachine;
extern uint8_t   g_ucBqStateMachineStep;
extern uint8_t   g_ucBqStateMachineBatteryChannel;
extern uint8_t   g_ucBqStateMachineSemaphore;
extern uint8_t   g_ausBqBatteryState[4][2];
extern uint8_t   g_ausBqBatteryRemainingDischargingTime[2];
extern uint8_t   g_ausBqBatteryTemperature[4][2];
extern uint8_t   g_ausBqBatteryVoltage[4][2];
extern uint8_t   g_ausBqBatteryCurrent[4][2];
extern uint8_t   g_ausBqBatteryRelativeStateOfCharge[4][1];
extern uint8_t   g_ausBqBatteryAbsoluteStateOfCharge[4][1];
extern uint8_t   g_ausBqBatteryRemainingCapacity[4][2];
extern uint8_t   g_ausBqBatteryFullChargeCapacity[4][2];
extern uint32_t  g_ulBqChargingCurrent;
extern uint32_t  g_ulBqChargingVoltage;
extern uint8_t   g_ausBqBatteryCellVoltage8[2];
extern uint8_t   g_ausBqBatteryCellVoltage7[2];
extern uint8_t   g_ausBqBatteryCellVoltage6[2];
extern uint8_t   g_ausBqBatteryCellVoltage5[2];
extern uint8_t   g_ausBqBatteryCellVoltage4[4][2];
extern uint8_t   g_ausBqBatteryCellVoltage3[4][2];
extern uint8_t   g_ausBqBatteryCellVoltage2[4][2];
extern uint8_t   g_ausBqBatteryCellVoltage1[4][2];
extern uint32_t  g_ausBqBatteryUpdateSysTime[4][4];
extern uint8_t   g_ausBqBatteryDeviceChemistry[5];
extern uint8_t   g_ausBqBatteryAverageCurrent[2];
extern uint8_t   g_ausBqBatteryStatus[2];

extern uint8_t   g_ucBqBatteryQuantity;
extern uint8_t   g_ucBqBatteryMultiMode;
extern uint8_t   g_ucBqBatteryMultiSelectChannel;
extern uint8_t   g_ucBqBatteryMultiChargerSemaphore;
extern uint8_t   g_ucBqBatteryMultiReadLagTime;
extern uint8_t   g_ucBqBatteryMultiCellExist;
extern uint8_t   g_ucBqBatteryMultiRetryCount;
extern uint8_t   g_ucBqBatteryMultiChargeGoal;
extern uint32_t  g_ulBqBatteryDelayTimer;

// BQ24745 ACTION 
extern uint32_t  g_ulBq24745DelayCmdTimer;
extern uint32_t  g_ulBq24745PrechargeTimer;
extern uint8_t  g_ucBq24745ChargerMode;
extern uint8_t  g_ucBq24745ChargerModeFlag[4];

// USBD_HID
extern USBD_HandleTypeDef  g_hUSBDDevice;
extern uint8_t g_USBD_HID_OutFlag;
extern uint8_t g_USBD_HID_InFlag; 
extern uint8_t g_USBD_HID_DataOutBuf[USBD_HID_DATA_OUT_BUF_SIZE]; 
extern uint8_t g_USBD_HID_OutStream[USBD_HID_DATA_OUT_BUF_SIZE]; 
extern uint8_t g_USBD_HID_InStream[USBD_HID_DATA_OUT_BUF_SIZE]; 

// ADC
extern ADC_HandleTypeDef g_AdcHandle;
extern __IO uint16_t g_ausADCReg[18];
extern __IO uint16_t g_ausADCRegTemp[18];
extern uint16_t g_ausADCValue[9][1];
extern uint8_t g_ausADCValueOffset[9][2];
extern uint16_t g_sAdcVDDA; 
extern uint8_t g_ucAdcUVPDelay;
//rock set charge current value
extern uint16_t g_Battery_current_from_smbus;

//
extern uint32_t g_ulPinStatus; 

// FAN PWM
extern TIM_HandleTypeDef g_TimHandle;
extern uint32_t g_ulFanDutyCycle, g_ulFanFrequency;
extern uint8_t  g_ucFanStopFlag;
extern uint8_t  g_ucFanPowerOffStopFlag;
//Rock Fan Line PWM Value
extern uint16_t  g_ucFanPwmControlValue;


// BEEP PWM
extern TIM_HandleTypeDef g_TimHandle_Beep;
extern TIM_HandleTypeDef g_TimHandle_Beep2;

extern uint8_t g_ucBeepPeriod;

// TEMPERATURE
extern uint32_t g_ulTemperature[2];

// I2C
extern I2C_HandleTypeDef g_I2c1Handle, g_I2c3Handle;
extern uint8_t g_ucI2CTxBuffer[4];
extern uint8_t g_ucI2CRxBuffer[1];
extern uint8_t g_ucHT66ActionFlagMCU;                         
extern uint8_t g_ucHT66ActionFlagApp;                        
extern uint8_t g_ucHT66Semaphore;
extern uint8_t g_ucHT66StateMachine;
extern uint8_t g_ucHT66Command[4];
extern uint8_t g_ucHT66CommandMcu[9];
extern uint8_t g_ucHT66FlashReadParaFlag;
extern uint8_t g_ucHT66Flash0x40;
extern uint8_t g_ucHT66CmdDoubleFlag;

extern uint8_t g_ucBatteryI2CTxBuffer[4];
extern uint8_t g_ucBatteryHT66ActionFlagMCU;                
extern uint8_t g_ucBatteryHT66ActionFlagApp;                
extern uint8_t g_ucBatteryHT66Semaphore;
extern uint8_t g_ucBatteryHT66StateMachine;
extern uint8_t g_ucBatteryHT66Command[4];
extern uint8_t g_ucBatteryHT66CommandMcu[4];
extern uint8_t g_ucBatteryHT66CmdDoubleFlag;
//Rock add second I2C 
extern uint8_t g_ucBatteryHT66ActionDelayFlag;
//Rock add delay for battery i2c at start
extern uint8_t g_battery_act;
extern uint16_t voutin;
extern uint16_t vboost2;
//Rock reini battery i2c
extern uint8_t g_ucReIniI2C1_Step;
extern uint32_t Rock_value_32;
extern uint16_t g_Rock_value[15];

//Rock add I2C shift flag
extern uint8_t g_ucHT66ActionFlagShift;
//Rock dealeay intit for en288
extern uint8_t DeleayFlag;



extern uint8_t g_PreChargeCurrentOnceCheck;
extern uint8_t g_PreChargeCurrentCounterGate;
extern uint8_t g_PreChargeCurrentPeriod;
extern uint16_t g_PreChargeCurrentGate;
extern uint8_t g_OcpCounter;
//22 to 26   26 to 29
extern uint8_t g_change_voltage;


// UART
extern UART_HandleTypeDef g_UartHandle;

// TEST
extern uint32_t g_ulRFU;
extern uint8_t g_ucDebug[4];

// FSP 650
extern uint8_t g_ucFSP650Cmd;
extern uint8_t g_ucFSP650Countdown;
extern uint8_t STR_TX_Buffer[15];
extern uint8_t SIR_counter;
//

extern uint8_t g_ChargerVoltageFlag;  //
extern uint8_t g_ChargerVoltageFlag2;


#endif  // __ADES_GLOBAL_VAR_H_
